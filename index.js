

magnetic_declination_akl = 20.24


//JSON 
courses = {
    "bbyc": {
        "4": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "5": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "6": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "7": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "8": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "9": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "10": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "11": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "12": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_SaltWorks",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NarrowNeck",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "13": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "port"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "14": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_SaltWorks",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "15": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "16": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "17": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "18": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "19": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "20": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "21": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_McKenzie",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_McKenzie",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_bbyc"
        },
        "22": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "23": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_BrownsIslandBeacon",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Navybuoy",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motuihegreen",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "24": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        },
        "25": {
            "start": "start",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "flag"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                }
            ],
            "finish": "finish_bbyc"
        }
    },
    "rnzys": {
        "1": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_StanleyPoint",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Westhaven",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Westhaven",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "2": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Westhaven",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Chelsea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "3": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Resolution",
                    "rounding": "port"
                },
                {
                    "mark": "mark_StanleyPoint",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "4": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_StanleyPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "5": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Resolution",
                    "rounding": "port"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "6": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "7": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "8": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_StanleyPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "9": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Orakei",
                    "rounding": "port"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Westhaven",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Chelsea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "10": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "11": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_BeanRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "12": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Orakei",
                    "rounding": "port"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "13": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Resolution",
                    "rounding": "port"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "14": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_StanleyPoint",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "15": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "16": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "port"
                },
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "17": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "18": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_SaltWorks",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "19": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BeanRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_SaltWorks",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "20": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "21": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Orakei",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Rangitoto",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "22": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Resolution",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NarrowNeck",
                    "rounding": "port"
                },
                {
                    "mark": "mark_RoughRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "23": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "24": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "25": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NarrowNeck",
                    "rounding": "port"
                },
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                }
            ],
            "finish": "finish_rnzys"
        },
        "26": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "27": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_BeanRock",
                    "rounding": "port"
                },
                {
                    "mark": "mark_McKenzie",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "28": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "29": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_FlaxPoint",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Iliomama",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "30": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Cable",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_McKenzie",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_NorthernLeading",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Orakei",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "31": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Bayswater",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Chelsea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Meola",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Chelsea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Meola",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "32": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Motukorea",
                    "rounding": "port"
                },
                {
                    "mark": "mark_NorthHead",
                    "rounding": "port"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        },
        "33": {
            "start": "start_rnzys",
            "course_route": [
                {
                    "mark": "mark_BeanRock",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Resolution",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Westhaven",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Chelsea",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_Bayswater",
                    "rounding": "stbd"
                },
                {
                    "mark": "mark_TorpedoBay",
                    "rounding": "stbd"
                }
            ],
            "finish": "finish_rnzys"
        }
    }
}

markers = {
    "start": {
        "name": "Start",
        "lat": "36°49.479S",
        "long": "174°52.451E"
    },
    "start_rnzys": {
        "name": "Start",
        "lat": "36°49.976S",
        "long": "174°45.167E"
    },
    "finish_bbyc": {
        "name": "Finish",
        "lat": "36°50.536S",
        "long": "174°52.625E"
    },
    "finish_rnzys": {
        "name": "Finish",
        "lat": "36°49.976S",
        "long": "174°45.167E"
    },
    "mark_Westhaven": {
        "name": "Westhaven",
        "lat": "36°49.90S",
        "long": "174°44.91E"
    },
    "mark_Bayswater": {
        "name": "Bayswater",
        "lat": "36°49.78S",
        "long": "174°45.77E"
    },
    "mark_StanleyPoint": {
        "name": "Stanley Point",
        "lat": "36°49.85S",
        "long": "174°46.59E"
    },
    "mark_Devonport": {
        "name": "Devonport",
        "lat": "36°50.00S",
        "long": "174°47.40E"
    },
    "mark_TorpedoBay": {
        "name": "Torpedo Bay",
        "lat": "36°50.11S",
        "long": "174°48.38E"
    },
    "mark_NorthHead": {
        "name": "North Head",
        "lat": "36°49.63S",
        "long": "174°49.08E"
    },
    "mark_RoughRock": {
        "name": "Rough Rock",
        "lat": "36°49.07S",
        "long": "174°49.50E"
    },
    "mark_NarrowNeck": {
        "name": "Narrow Neck",
        "lat": "36°47.83S",
        "long": "174°48.51E"
    },
    "mark_Cable": {
        "name": "Cable",
        "lat": "36°47.61S",
        "long": "174°47.28E"
    },
    "mark_McKenzie": {
        "name": "McKenzie",
        "lat": "36°46.84S",
        "long": "174°49.05E"
    },
    "mark_SaltWorks": {
        "name": "Salt Works",
        "lat": "36°47.80S",
        "long": "174°49.36E"
    },
    "mark_FlaxPoint": {
        "name": "Flax Point",
        "lat": "36°48.41S",
        "long": "174°49.95E"
    },
    "mark_Rangitoto": {
        "name": "Rangitoto",
        "lat": "36°48.80S",
        "long": "174°50.84E"
    },
    "mark_NorthernLeading": {
        "name": "Northern Leading",
        "lat": "36°49.33S",
        "long": "174°50.60E"
    },
    "mark_BeanRock": {
        "name": "Bean Rock",
        "lat": "36°50.19S",
        "long": "174°49.63E"
    },
    "mark_Bastion": {
        "name": "Bastion",
        "lat": "36°50.41S",
        "long": "174°49.36E"
    },
    "mark_Orakei": {
        "name": "Orakei",
        "lat": "36°50.54S",
        "long": "174°48.72E"
    },
    "mark_Resolution": {
        "name": "Resolution",
        "lat": "36°50.66S",
        "long": "174°47.89E"
    },
    "mark_Chelsea": {
        "name": "Chelsea",
        "lat": "36°49.68S",
        "long": "174°43.80E"
    },
    "mark_Meola": {
        "name": "Meola",
        "lat": "36°49.81S",
        "long": "174°42.66E"
    },
    "mark_GulfHarbour": {
        "name": "Gulf Harbour",
        "lat": "36°39.13S",
        "long": "174°48.03E"
    },
    "mark_Torbay": {
        "name": "Torbay",
        "lat": "36°42.50S",
        "long": "174°47.30E"
    },
    "mark_Iliomama": {
        "name": "Iliomama",
        "lat": "36°48.70S",
        "long": "174°52.62E"
    },
    "mark_SergeantChannel": {
        "name": "Sergeant Channel",
        "lat": "36°49.30S",
        "long": "174°57.40E"
    },
    "mark_RockyBay": {
        "name": "Rocky Bay",
        "lat": "36°49.98S",
        "long": "175°03.30E"
    },
    "mark_Motukorea": {
        "name": "Motukorea",
        "lat": "36°49.80S",
        "long": "174°52.00E"
    },
    "mark_Motuihegreen": {
        "name": "Motuihe Green",
        "lat": "36°48.171S",
        "long": "174°55.295E"
    },
    "mark_Navybuoy": {
        "name": "Navy Buoy",
        "lat": "36°49.899S",
        "long": "174°54.678E"
    },
    "mark_BrownsIslandBeacon": {
        "name": "Browns Island Beacon",
        "lat": "36°49.438S",
        "long": "174°53.927E"
    }
}


//change this to handle lat and long (remove code duplication, maybe break into another function)
function convert_coordinates(marker) {
    degrees = marker.lat.split("°")[0];
    minutes = marker.lat.split("°")[1].slice(0, -1);
    cardinal = marker.lat.split("°")[1].slice(-1);
    decimal_degrees = Number(degrees) + Number(minutes) / 60;

    if (cardinal == "S" || cardinal == "W") {
        decimal_degrees = decimal_degrees * -1;
    }

    marker.lat = decimal_degrees

    degrees = marker.long.split("°")[0];
    minutes = marker.long.split("°")[1].slice(0, -1);
    cardinal = marker.long.split("°")[1].slice(-1);
    decimal_degrees = Number(degrees) + Number(minutes) / 60;

    if (cardinal == "S" || cardinal == "W") {
        decimal_degrees = decimal_degrees * -1;
    }

    marker.long = decimal_degrees
}


//convert coordinates for unique markers for a given course
function get_unique_markers(course) {
    course_full = []
    for (let i = 0; i < course.length; i++) {
        course_full.push(course[i].mark)
    }
    let unique_markers = [...new Set(course_full)];

    for (let i = 0; i < unique_markers.length; i++) {
        if (typeof (markers[unique_markers[i]].lat) != "number") {
            convert_coordinates(markers[unique_markers[i]])
        }
    }
}


function degrees_to_radians(degrees) {
    pi = Math.PI;
    radians = degrees * (pi / 180);
    return radians
}


function radians_to_degrees(radians) {
    pi = Math.PI;
    degrees = radians * (180 / pi);
    return degrees
}


function find_angle(markA, markB) {
    alon = markA.long
    blon = markB.long
    alat = markA.lat
    blat = markB.lat

    alon = degrees_to_radians(alon)
    blon = degrees_to_radians(blon)
    alat = degrees_to_radians(alat)
    blat = degrees_to_radians(blat)

    Dlon = blon - alon

    varX = Math.cos(blat) * Math.sin(Dlon);
    varY = Math.cos(alat) * Math.sin(blat) - Math.sin(alat) * Math.cos(blat) * Math.cos(Dlon);

    angle_true = Math.atan2(varX, varY);
    angle_true = radians_to_degrees(angle_true);
    angle_true = (angle_true + 360) % 360;
    angle_magnetic = angle_true - magnetic_declination_akl
    //TODO add mechanism (radio button?) for selecting true or mag north
    committee_boat_flag_colour = document.querySelector('input[name="committee-flag"]:checked').value

    if (get_north_direction() == "magnetic") {
        angle = angle_magnetic
    }
    else {
        angle = angle_true
    }
    return angle
}


function get_north_direction() {
    north_direction = document.querySelector('input[name="north-direction"]:checked').value
    return north_direction
}


function course_with_angles(course) {
    course_angles = []
    for (let i = 0; i < course.length - 1; i++) {
        course_angles.push({ mark_name: markers[course[i].mark], coursemarker: course[i].mark, angle_next_mark: find_angle(markers[course[i].mark], markers[course[i + 1].mark]) });
    }
    return course_angles
}


function getFlagColour() {
    committee_boat_flag_colour = document.querySelector('input[name="committee-flag"]:checked').value
    return committee_boat_flag_colour
}


function setCommitteeBoatDisplay(first_mark_rounding) {
    boat = document.getElementById("committee-boat")
    if (first_mark_rounding == "flag") {
        boat.style.display = "inline"
    }
    else {
        boat.style.display = "none"
    }
}

function setMarkRoundingTextColour() {
    switch (rounding) {
        case "port":
            mark_rounding_class = "mark_rounding_port"
            break
        case "stbd":
            mark_rounding_class = "mark_rounding_stbd"
            break
        case "flag":
            switch (getFlagColour()) {
                case "port":
                    mark_rounding_class = "mark_rounding_port"
                    break
                case "stbd":
                    mark_rounding_class = "mark_rounding_stbd"
                    break
                default:
                    mark_rounding_class = "None"
            }
            break
        default:

            mark_rounding_class = "None"
    }
}

function wind_angle(club, course, wind_direction, course_num) {
    course_angles = course_with_angles(course.course_route)
    // Generate course description HTML output
    course_description_section = document.getElementById("course-description")
    course_description_heading = document.createElement("h3")
    course_description_heading.innerHTML += club.toUpperCase() + " Course " + course_num
    course_description_p = document.createElement("p")

    course_leg = document.createElement("p")
    course_leg.innerHTML = markers[course.start].name + '<br>'
    course_description_p.replaceChildren(course_leg)

    first_mark_rounding = course.course_route[0].rounding
    setCommitteeBoatDisplay(first_mark_rounding)

    for (let i = 0; i < course_angles.length; i++) {
        angle_wind = wind_direction - course_angles[i].angle_next_mark
        angle_wind = (angle_wind + 360) % 180;
        course_angles[i].wind_next_mark = angle_wind
        mark_name = markers[course.course_route[i].mark].name
        next_mark_name = markers[course.course_route[i + 1].mark].name
        rounding = course.course_route[i].rounding
        setMarkRoundingTextColour()

        course_leg = document.createElement("p")
        course_leg.setAttribute("class", mark_rounding_class)
        course_leg.innerHTML = mark_name + '<br>'
        course_description_p.appendChild(course_leg)
        course_leg_angles = document.createElement("p")
        //course_leg_angles.setAttribute("class", [classname])
        if (get_north_direction() == "magnetic") {
            course_leg_angles.innerHTML = Math.round(course_angles[i].angle_next_mark) + '°M. TWA: ' + Math.round(course_angles[i].wind_next_mark) + '°'
        }
        else {
            course_leg_angles.innerHTML = Math.round(course_angles[i].angle_next_mark) + '°T. TWA: ' + Math.round(course_angles[i].wind_next_mark) + '°'
        }


        course_description_p.appendChild(course_leg_angles)
    }

    course_leg = document.createElement("p")
    course_leg.innerHTML = next_mark_name + '<br>'
    course_leg.setAttribute("class", mark_rounding_class)
    course_description_p.appendChild(course_leg)

    course_leg = document.createElement("p")
    course_leg.innerHTML = markers[course.finish].name, '<br>'
    course_description_p.appendChild(course_leg)

    course_description_section.replaceChildren(course_description_heading, course_description_p)
}

//Stuff on the webpage
function clubList() {
    select_club = document.getElementById("club")
    for (const [key, value] of Object.entries(courses)) {
        select_club.options[select_club.options.length] = new Option(key.toUpperCase(), key)
    }
    courseList()
}
window.onload = clubList

function courseList() {
    club = document.getElementById("club")
    course_number = document.getElementById("course-number")
    club_courses = courses[club.value]
    course_number.length = 0

    for (const [key, value] of Object.entries(club_courses)) {
        course_number.options[course_number.length] = new Option(key, key)
    }
}


function get_course() {
    club = document.getElementById("club").value
    course_num = document.getElementById("course-number").value
    wind_dir = document.getElementById("wind-direction").value
    if (get_north_direction()=="magnetic") {
        wind_dir -= magnetic_declination_akl
    }
    get_unique_markers(courses[club][course_num].course_route) //gets unique markers and converts GPS coordinates to decimal degrees
    wind_angle(club, courses[club][course_num], wind_dir, course_num)
}
